version: 2.1

orbs:
  python: circleci/python@0.2.1

jobs:
  build:
    steps:
      - checkout
      - run:
          name: Generate  markdown documents, thehive templates and 
          command: |
            python ./main.py --markdown --auto --init
            python ./main.py --thehive
            python ./main.py -MK
            echo ""
            echo ""
            git status
            echo ""
            echo ""
            git diff-index HEAD --
            if git diff-index --quiet HEAD -- ; then
              echo "Not committing documentation because there are no changes"
            #elif [[ "${CIRCLE_BRANCH}" == "master" ]]; then
            #  echo "Not committing documentation because we are on master and doc changes should be part of pull request branches"
            elif [[ $(echo "develop" | grep -c "pull") -gt 0 ]]; then
              echo "Not committing documentation because we are on a pull request branch that we don't have push permissions to"
            else
              git config credential.helper 'cache --timeout=120'
              git config user.email "<email>"
              git config user.name "CircleCI ATC RE&CT doc generator"
              git add --all
              git commit -am "Generate docs from job=$CIRCLE_JOB branch=develop"
              git push -u origin develop
            fi

